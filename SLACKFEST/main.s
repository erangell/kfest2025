; APPLE 2C SERIAL MIDI OUTPUT TO ARDUINO TO YAMAHA EZAG GUITAR
; ASSEMBLE WITH CYANIIDE MERLINE IDE AT PALEOTRONIC.COM/MERLIN
			ORG $6000
DELAY		EQU	$FCA8
MAININIT	JMP INITSERIAL
			JMP GTRSTRUM
			JMP GTRDAMP
			JMP MIDIOUT			
			JMP SYSXOUT
			JMP MIDITEST
;
GTRFRETS	DFB $00,$00,$00,$00,$00,$00
GTRTUNE		DFB 40,45,52,55,59,64
LIGHTS		DFB 53,58,63,68,72,77
STRUMDLY	DFB $01	; DELAY BETWEEN STRINGS WHEN STRUMMING
SYSEX		DFB $F0,$43,$7F,$00,$00,$03,$06,$35,$F7
MIDICHNL	DFB $00 ; TO CHANGE MIDI CHANNEL FOR OUTPUT
MIDIVEL		DFB $40 ; MIDI VELOCITY FOR NOTE ONS
;
INITSERIAL	LDA #$1F	; APPLE 2C SERIAL PORT MAPPED TO SLOT 2
			STA $C0A3
			LDA #$0B
			STA $C0A2
			RTS
MIDIOUT		PHA
			LDA #$10
WTREADY		BIT $C0A1
			BEQ WTREADY
			PLA
			STA $C0A0
			RTS
SYSXOUT		LDX #$00
			LDA SYSEX,X
SYSXLOOP	JSR MIDIOUT
			INX
			LDA SYSEX,X
			CMP #$F7
			BNE SYSXLOOP
			JSR MIDIOUT
			RTS
MIDITEST	LDA MIDICHNL
			CLC
			ADC #$90
			JSR MIDIOUT
			LDA #$3C	; MIDDLE C
			JSR MIDIOUT
			LDA MIDIVEL
			JSR MIDIOUT
			LDA #$FF
			JSR DELAY
			LDA MIDICHNL
			CLC
			ADC #$90
			JSR MIDIOUT
			LDA #$3C	; MIDDLE C
			JSR MIDIOUT
			LDA #$00	; NOTE OFF
			JSR MIDIOUT
			JSR SYSXOUT
			RTS
GTRSTRUM	LDY MIDICHNL
			LDX #$00
			CLC
			ADC #$90
			JSR MIDIOUT
			LDA GTRFRETS,X
			CLC
			ADC GTRTUNE,X
			JSR MIDIOUT
			LDA MIDIVEL
			JSR MIDIOUT
			LDA STRUMDLY
			JSR	DELAY
			INX
			CPX #$06
			BNE GTRSTRUM
			RTS
GTRDAMP		LDA MIDIVEL
			PHA
			LDA #$00
			STA MIDIVEL
			JSR GTRSTRUM
			PLA
			STA MIDIVEL	
			RTS
